---
  # LMD
  - name: Create LMD's download dir
    file:
      path: /tmp/downloads/maldet
      state: directory
      recurse: yes
  - name: Maldet | download the Linux Malware Detect tar.gz file from rfxn.com
    get_url:
      url=http://www.rfxn.com/downloads/maldetect-current.tar.gz
      dest="/tmp/downloads/maldetect-current.tar.gz"
  - name: Maldet | Unarchive copied package
    unarchive:
      src: /tmp/downloads/maldetect-current.tar.gz
      dest: /tmp/downloads/maldet
      extra_opts: [--strip-components=1]
      copy: no
  - name: Maldet | Install Linux Malware Detect
    shell: /tmp/downloads/maldet/install.sh chdir=/tmp/downloads/maldet/
    changed_when: False
  - name: Maldet | Add maldet to crontab at a random hour
    cron: name="Run Maldet" hour="{{ 0 }}" minute="{{ 20 }}" job="maldet -b -r /" state=present
    changed_when: False
  - name: copy maldet configuration file
    template:
      src: templates/maldet/conf.maldet
      dest: /usr/local/maldetect/conf.maldet
      owner: root
      group: root
      mode: 0755
